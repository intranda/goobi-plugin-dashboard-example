<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:p="http://primefaces.org/ui">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <div class="row">
            <div class="col-sm-12">
                <div class="box box-color box-bordered">
                    <div class="box-title">
                        <h3>
                            <i class="fa fa-table"></i>
                            <h:outputText
                                value="#{msgs.batch}"
                                class="margin-right-5" />
                        </h3>


                    </div>
                    <div class="box-content nopadding">

                        <h:panelGrid
                            columns="2"
                            styleClass="table table-hover table-bordered"
                            columnClasses="columnLabel, columnValue">

                            <h:outputText value="#{msgs.startDate}" />
                            <h:outputText value="#{DashboardForm.plugin.selectedStartDate}" />

                            <h:outputText value="#{msgs.today}" />
                            <h:outputText value="#{DashboardForm.plugin.today}" />

                            <h:outputText value="#{msgs.endDate}" />
                            <h:outputText value="#{DashboardForm.plugin.selectedEndDate}" />


                        </h:panelGrid>

                    </div>
                </div>

                <h:form>
                    <div class="box box-color box-bordered">
                        <div class="box-title">
                            <h3>
                                <i class="fa fa-table"></i>
                                <h:outputText
                                    value="#{msgs.batch}"
                                    class="margin-right-5" />
                            </h3>

                            <div class="actions">
                                <h:commandLink
                                    id="reload"
                                    action="#{DashboardForm.plugin.loadAllData}"
                                    styleClass="btn btn-mini"
                                    title="#{msgs.reload}"
                                    rel="tooltip">
                                    <i
                                        class="fa fa-refresh"
                                        title="#{msgs.reload}"
                                        rel="tooltip" />
                                    <f:passThroughAttribute
                                        name="data-toggle"
                                        value="tooltip" />
                                </h:commandLink>
                            </div>

                        </div>
                        <div class="box-content nopadding">
                            <x:dataTable
                                style="width:100%"
                                var="batch"
                                value="#{DashboardForm.plugin.batchesInInterval}">
                                <x:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msgs.id}" />
                                    </f:facet>
                                    <h:outputText value="#{batch.id}" />
                                </x:column>

                                <x:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msgs.batchName}" />
                                    </f:facet>
                                    <h:outputText value="#{batch.batchName}" />
                                </x:column>

                                <x:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msgs.startDate}" />
                                    </f:facet>
                                    <h:outputText value="#{batch.startDate}" />
                                </x:column>

                                <x:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msgs.endDate}" />
                                    </f:facet>
                                    <h:outputText value="#{batch.endDate}" />
                                </x:column>

                                <x:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msgs.totalProcesses}" />
                                    </f:facet>
                                    <h:outputText value="#{batch.totalProcesses}" />
                                </x:column>

                                <x:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msgs.progressUnprocessed}" />
                                    </f:facet>
                                    <h:outputText value="#{batch.progressUnprocessed}" />
                                </x:column>

                                <x:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msgs.progressProcessed}" />
                                    </f:facet>
                                    <h:outputText value="#{batch.progressProcessed}" />
                                </x:column>

                                <x:column>
                                    <f:facet name="header">
                                        <h:outputText value="#{msgs.progressReturned}" />
                                    </f:facet>
                                    <h:outputText value="#{batch.progressReturned}" />
                                </x:column>
                            </x:dataTable>
                        </div>
                    </div>
                </h:form>

                <div class="box box-color box-bordered">
                    <div class="box-title">
                        <h3>
                            <i class="fa fa-table"></i>
                            <h:outputText
                                value="#{msgs.batchDetails}"
                                class="margin-right-5" />
                        </h3>


                    </div>
                    <div class="box-content nopadding">
                      <canvas id="myCanvas" width="500" height="400" style="border:1px solid #000000;margin-top:30px;width:100%;"></canvas> 
                    </div>
                </div>
                
                <div class="box box-color box-bordered">
                    <div class="box-title">
                        <h3>
                            <i class="fa fa-table"></i>
                            <h:outputText
                                value="#{msgs.batchDetails}"
                                class="margin-right-5" />
                        </h3>


                    </div>
                    <div class="box-content nopadding">

                        <h:panelGrid
                            columns="2"
                            styleClass="table table-hover table-bordered"
                            columnClasses="columnLabel, columnValue">

                            <h:outputText value="#{msgs.batchesNotStarted}" />
                            <h:outputText value="#{DashboardForm.plugin.batchesNotStarted}" />

                            <h:outputText value="#{msgs.batchesInwork}" />
                            <h:outputText value="#{DashboardForm.plugin.batchesInwork}" />

                            <h:outputText value="#{msgs.finishedBatches}" />
                            <h:outputText value="#{DashboardForm.plugin.finishedBatches}" />


                            <h:outputText value="#{msgs.processesWithoutBatch}" />
                            <h:outputText value="#{DashboardForm.plugin.processesWithoutBatch}" />

                            <h:outputText value="#{msgs.processesWithErrors}" />
                            <h:outputText value="#{DashboardForm.plugin.processesWithErrors}" />

                            <h:outputText value="#{msgs.progress}" />
                            <h:outputText value="#{DashboardForm.plugin.totalProgress}" />
                        </h:panelGrid>

                    </div>
                </div>
            </div>
        </div>
        
        <hr/>
        <h:outputText value="#{DashboardForm.plugin.batchesAsJson}"/>
        <hr/>
        <h:outputText value="#{DashboardForm.plugin.allDatesAsJson}"/>
        <hr/>
        
        <script type="text/javascript">	
		//<![CDATA[

			// json 1
			// var john = JSON.parse('{ "name":"John", "age":30, "city":"New York"}');
			// console.log(john.name + ", " + john.age); 
			
			// json 2
			// var json = '{ "name":"Steffen", "age":41, "city":"GÃ¶ttingen"}';
			// var steffen = JSON.parse(json);
			// console.log(steffen.name + ", " + steffen.age); 
			
			// json 3
			// var batchJson = '{"dates": ["01.01.", "02.01.", "03.01"],"batches": [{"start":"a1", "end":"a2","locked":"a10","done":"a20","inwork":"a30"},{"start":"b1", "end":"b2","locked":"b10","done":"b20","inwork":"b30"},{"start":"c1", "end":"c2","locked":"c10","done":"c20","inwork":"c30"}]}';
			// var batchObject = JSON.parse(batchJson);
			// console.log(batchObject.dates); 
			
			// list all dates
			// for (var i = 0; i < batchObject.dates.length; i++) {
			//    var date = batchObject.dates[i];
			// 	  console.log(date);
			// }

			// list all batches
			// for (var i = 0; i < batchObject.batches.length; i++) {
			//    var batch = batchObject.batches[i];
			//    console.log(batch.start + " - " + batch.end);
			// }
			
			// preparation of the canvas
			var c = document.getElementById("myCanvas");
			c.width=$(c).width();
			//c.height=$(c).height();
			//$(c).height();
			c.height=5*200;
			
			// json dates
			var dates = JSON.parse('#{DashboardForm.plugin.allDatesAsJson}');
			// console.log(dates); 
			for (var i = 0; i < dates.length; i++) {
			    var date = dates[i];
			    var percent = 100*(i)/dates.length;
			    var position = c.width*percent/100;
			    var position2 = c.width*i/dates.length;
			    console.log(date.label + " - " + percent + " - " + position + " - " + position2);
			 	// draw a line
				var line = c.getContext("2d");
				line.moveTo(position,0);
				line.lineTo(position,5);
				line.stroke();
			}
			
			// draw a line
			// var ctx = c.getContext("2d");
			// ctx.moveTo(0,0);
			// ctx.lineTo(200,100);
			// ctx.stroke();
			
			// draw text
			// ctx.font = "15px Arial";
			// ctx.fillText("Hello World",10,50); 
			
			// draw a rectangle
			// ctx.beginPath();
			// ctx.lineWidth="6";
			// ctx.strokeStyle="red";
			// ctx.rect(5,5,290,140);
			// ctx.stroke();
			
			// run through a loop
			// var schritt;
			// for (schritt = 0; schritt < 5; schritt++) {
			//  console.log('Gehe einen Schritt: ' + schritt);
			// }
		       
		//]]>
		</script>
		
    </composite:implementation>

</ui:composition>