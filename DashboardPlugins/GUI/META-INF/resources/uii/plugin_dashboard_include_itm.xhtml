<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:composite="http://xmlns.jcp.org/jsf/composite"
	xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:x="http://myfaces.apache.org/tomahawk" xmlns:p="http://primefaces.org/ui">

	<composite:interface>
	</composite:interface>

	<composite:implementation>
		<h:form id="dashboard-itm">
			<div class="box box-color lightgrey box-bordered">
				<div class="box-title">
					<h3>
						<i class="fa fa-briefcase"></i>
						<h:outputText value="intranda TaskManager: " />
						<h:outputText value="Plugins" rendered="#{DashboardForm.plugin.itmHelper.currentItmPlugin == null}" />
						<h:outputText value="#{DashboardForm.plugin.itmHelper.currentItmPlugin.name}" rendered="#{DashboardForm.plugin.itmHelper.currentItmPlugin != null}" />
					</h3>

					<div class="actions">
					
						<!-- reload all data again -->
						<h:commandLink styleClass="btn btn-mini" action="#{NavigationForm.Reload}" title="#{msgs.reload}">
							<i class="fa fa-refresh" />
							<f:setPropertyActionListener target="#{DashboardForm.plugin.itmHelper.lastRead}" value="#{null}" />
							<f:ajax render=":dashboard-itm" />
						</h:commandLink>
						<!-- // reload all data again -->
						
						<!-- close current queue and show all itm plugins again -->
						<h:commandLink styleClass="btn btn-mini" action="#{NavigationForm.Reload}" title="#{msgs.uebersicht}"
							rendered="#{DashboardForm.plugin.itmHelper.currentItmPlugin != null}">
							<i class="fa fa-desktop" />
							<f:setPropertyActionListener target="#{DashboardForm.plugin.itmHelper.currentItmPlugin}" value="#{null}" />
							<f:ajax render=":dashboard-itm" />
						</h:commandLink>
						<!-- // close current queue and show all itm plugins again -->
					</div>
					
					<!-- show tabs to select between job status -->
					<h:panelGroup rendered="#{DashboardForm.plugin.itmHelper.currentItmPlugin != null}">
						<ul class="tabs">
							<li class="#{NavigationForm.uiStatus.dashboard_itm eq 'processing'?'active':''}">
								<h:commandLink action="#{NavigationForm.Reload}" value="Processing">
									<f:setPropertyActionListener target="#{NavigationForm.uiStatus.dashboard_itm}" value="processing" />
									<f:ajax render=":dashboard-itm" />
								</h:commandLink>
							</li>
							<li class="#{NavigationForm.uiStatus.dashboard_itm eq 'done'?'active':''}">
								<h:commandLink action="#{NavigationForm.Reload}" value="Done">
									<f:setPropertyActionListener target="#{NavigationForm.uiStatus.dashboard_itm}" value="done" />
									<f:ajax render=":dashboard-itm" />
								</h:commandLink>
							</li>
							<li class="#{NavigationForm.uiStatus.dashboard_itm eq 'error'?'active':''}">
								<h:commandLink action="#{NavigationForm.Reload}" value="Error">
									<f:setPropertyActionListener target="#{NavigationForm.uiStatus.dashboard_itm}" value="error" />
									<f:ajax render=":dashboard-itm" />
								</h:commandLink>
							</li>
						</ul>
					</h:panelGroup>
					<!-- // show tabs to select between job status -->

				</div>
				<div class="box-content nopadding">

					<h:panelGroup style="padding:20px;display:block;" rendered="#{DashboardForm.plugin.itmHelper.itmPlugins == null}">
						<h:outputText styleClass="alert alert-info alert-dismissable margin-bottom-10" value="#{msgs.dashboard_noItmConnection}" />
 						<p:poll interval="3" listener="#{DashboardForm.plugin.update}" update="dashboard-itm" rendered="#{DashboardForm.plugin.itmHelper.itmPlugins == null}"/> 
					</h:panelGroup>
		
					<!-- no queue loaded - show list of all itm plugins -->
					<h:panelGroup rendered="#{DashboardForm.plugin.itmHelper.itmPlugins != null and DashboardForm.plugin.itmHelper.currentItmPlugin == null}" >
						
						<table class="table table-hover responsive">
							<tbody>
	
								<ui:repeat var="item" value="#{DashboardForm.plugin.itmHelper.itmPlugins}">
									<tr>
										<td>
											<h:commandLink styleClass="font-black" value="#{item.name}" rel="tooltip" action="#{NavigationForm.Reload}" title="#{item.name}">
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<f:setPropertyActionListener target="#{DashboardForm.plugin.itmHelper.currentItmPlugin}" value="#{item}" />
												<f:setPropertyActionListener target="#{NavigationForm.uiStatus.dashboard_itm}" value="done" />
												<f:ajax render=":dashboard-itm"></f:ajax>
											</h:commandLink>
										</td>
										<td>
											<h:commandLink styleClass="font-black" value="#{item.number} Jobs" rel="tooltip" action="#{NavigationForm.Reload}" title="#{item.number} Jobs">
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<f:setPropertyActionListener target="#{DashboardForm.plugin.itmHelper.currentItmPlugin}" value="#{item}" />
												<f:setPropertyActionListener target="#{NavigationForm.uiStatus.dashboard_itm}" value="done" />
												<f:ajax render=":dashboard-itm"></f:ajax>
											</h:commandLink>
										</td>
										<td>
											<h:commandLink styleClass="pull-right margin-right-regular" rel="tooltip" action="#{NavigationForm.Reload}" title="#{item.running}">
												<h:outputText styleClass="badge font-size-xs #{item.running eq 'running'?'badge-intranda-green':'badge-intranda-red'}" style="font-weight:normal" value=" #{item.running} " />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<f:setPropertyActionListener target="#{DashboardForm.plugin.itmHelper.currentItmPlugin}" value="#{item}" />
												<f:setPropertyActionListener target="#{NavigationForm.uiStatus.dashboard_itm}" value="done" />
												<f:ajax render=":dashboard-itm"></f:ajax>
											</h:commandLink>
										</td>
									</tr>
								</ui:repeat>
							</tbody>
						</table>
					</h:panelGroup>
					<!-- // no queue loaded - show list of all itm plugins -->

					<!-- one queue is selected - show details -->
					<h:panelGroup rendered="#{DashboardForm.plugin.itmHelper.itmPlugins != null and DashboardForm.plugin.itmHelper.currentItmPlugin != null and NavigationForm.uiStatus.dashboard_itm ne 'error'}" >
						<table class="table table-hover responsive">
							<tbody>
								<ui:repeat var="item" value="#{NavigationForm.uiStatus.dashboard_itm eq 'done'?DashboardForm.plugin.itmHelper.currentItmPlugin.listDone:DashboardForm.plugin.itmHelper.currentItmPlugin.listProcessing}" varStatus="status">
									<tr>
										<td>#{item.goobiId}</td>
										<td class="tableColumnMaxWidthLong" title="#{item.goobiProcessTitle}">#{item.goobiProcessTitle}</td>
										<td>#{item.size}</td>
										<td>#{item.abbyyPages}</td>
										<td class="tableColumnMaxWidthLong" title="#{item.status}">#{item.status}</td>
									</tr>
								</ui:repeat>
							</tbody>
						</table>
					</h:panelGroup>
					
					<h:panelGroup rendered="#{DashboardForm.plugin.itmHelper.itmPlugins != null and DashboardForm.plugin.itmHelper.currentItmPlugin != null and NavigationForm.uiStatus.dashboard_itm eq 'error'}" >
						<table class="table table-hover responsive">
							<tbody>
								<ui:repeat var="item" value="#{DashboardForm.plugin.itmHelper.currentItmPlugin.listError}" varStatus="status">
									<tr>
										<td>#{item.goobiId}</td>
										<td class="tableColumnMaxWidthLong" title="#{item.goobiProcessTitle}">#{item.goobiProcessTitle}</td>
										<td class="tableColumnMaxWidthLong" title="#{item.errorMessage}" >#{item.errorMessage}</td>
										<td class="tableColumnMaxWidthLong" title="#{item.status}">#{item.status}</td>
									</tr>
								</ui:repeat>
							</tbody>
						</table>
					</h:panelGroup>
					<!-- // one queue is selected - show details -->

				</div>
			</div>
		</h:form>
	</composite:implementation>

</ui:composition>


